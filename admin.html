<!DOCTYPE html>
<html lang="hi">
<head>
    <meta charset="UTF-8">
    <title>SAHI Admin</title>
    <style>
        body { background: #0b0e14; color: white; font-family: sans-serif; padding: 20px; }
        .card { background: #161b22; padding: 20px; border-radius: 15px; border: 1px solid #333; margin-bottom: 20px; }
        input { width: 100%; padding: 10px; margin: 10px 0; background: #000; border: 1px solid #444; color: white; box-sizing: border-box; }
        button { width: 100%; padding: 12px; background: #38bdf8; border: none; font-weight: bold; border-radius: 8px; cursor: pointer; }
        .list-item { display: flex; justify-content: space-between; padding: 10px; border-bottom: 1px solid #333; }
    </style>
</head>
<body>
    <h2>üõ†Ô∏è SAHI Admin Control</h2>

    <div class="card">
        <h3>üéØ Set Market Plan (24h)</h3>
        <input type="number" id="t-price" placeholder="Target Price (e.g., 172)">
        <button onclick="updateMarket()">Set & Deploy Target</button>
    </div>

    <div class="card">
        <h3>üì• Wallet Requests</h3>
        <div id="req-list"></div>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getFirestore, doc, setDoc, onSnapshot, collection, query, where, updateDoc, getDoc, serverTimestamp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

        // Import the functions you need from the SDKs you need
import { initializeApp } from "firebase/app";
import { getAnalytics } from "firebase/analytics";
// TODO: Add SDKs for Firebase products that you want to use
// https://firebase.google.com/docs/web/setup#available-libraries

// Your web app's Firebase configuration
// For Firebase JS SDK v7.20.0 and later, measurementId is optional
const firebaseConfig = {
  apiKey: "AIzaSyCuCNl6FOWldVkjGAlqU1eTxPPOWn_pKtY",
  authDomain: "lightspeed-trading-1dec9.firebaseapp.com",
  projectId: "lightspeed-trading-1dec9",
  storageBucket: "lightspeed-trading-1dec9.firebasestorage.app",
  messagingSenderId: "787355268629",
  appId: "1:787355268629:web:c5c39b7706c6a3548e001c",
  measurementId: "G-BMG3R0GB2T"
};

// Initialize Firebase
const app = initializeApp(firebaseConfig);
const analytics = getAnalytics(app);
        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);

        window.updateMarket = async () => {
            const target = parseFloat(document.getElementById('t-price').value);
            await setDoc(doc(db, "settings", "market_config"), {
                targetPrice: target,
                minPrice: 160,
                maxPrice: 175,
                lastUpdate: serverTimestamp()
            }, {merge: true});
            alert("Market Target Set!");
        };

        onSnapshot(query(collection(db, "requests"), where("status", "==", "pending")), s => {
            const list = document.getElementById('req-list');
            list.innerHTML = "";
            s.forEach(d => {
                const r = d.data();
                list.innerHTML += `<div class="list-item">
                    <span>${r.email} - ‚Çπ${r.amount} (${r.type})</span>
                    <button onclick="approve('${d.id}', '${r.uid}', ${r.amount}, '${r.type}')" style="width:80px; background:green;">Approve</button>
                </div>`;
            });
        });

        window.approve = async (id, uid, amt, type) => {
            const uRef = doc(db, "users", uid);
            const uSnap = await getDoc(uRef);
            let newB = type === 'Deposit' ? (uSnap.data().wallet + amt) : (uSnap.data().wallet - amt);
            await updateDoc(uRef, {wallet: newB});
            await updateDoc(doc(db, "requests", id), {status: 'approved'});
            alert("Done!");
        };
    </script>
</body>
</html>
