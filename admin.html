<!DOCTYPE html>
<html lang="hi">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>SAHI Admin | Control Center</title>

<style>
:root{
 --bg:#0b0e14;--card:#161b22;
 --primary:#6366f1;--green:#22c55e;--red:#ef4444;
}
body{
 background:var(--bg);color:#fff;
 font-family:Segoe UI,sans-serif;
 padding:20px;display:none;
}
.header{
 display:flex;justify-content:space-between;align-items:center;
 border-bottom:1px solid #30363d;padding-bottom:15px;margin-bottom:25px
}
.section-title{
 font-size:18px;color:var(--primary);
 border-left:4px solid var(--primary);
 padding-left:10px;margin:25px 0 10px;font-weight:700
}
.card{
 background:var(--card);border:1px solid #30363d;
 border-radius:12px;padding:15px;margin-bottom:10px;
 display:flex;justify-content:space-between;align-items:center
}
button{
 padding:10px 16px;border:none;border-radius:8px;
 font-weight:700;cursor:pointer
}
.btn-ok{background:var(--green);color:#000}
.btn-edit{background:var(--primary);color:#fff}
.btn-danger{background:var(--red);color:#fff}
.info b{display:block}
.info span{font-size:12px;opacity:.6}
.market-ctrl{
 background:var(--card);border:1px solid #30363d;
 padding:20px;border-radius:14px
}
.grid{display:grid;grid-template-columns:1fr 1fr 1fr;gap:10px}
</style>
</head>

<body>

<div class="header">
 <h1>üõ†Ô∏è SAHI Admin Panel</h1>
 <button onclick="location.reload()">Refresh</button>
</div>

<!-- MARKET CONTROL -->
<div class="market-ctrl">
 <div class="section-title" style="margin-top:0">üìà Market Trend Control</div>
 <p style="font-size:12px;opacity:.6">Price direction control (demo)</p>
 <div class="grid">
  <button class="btn-ok" onclick="setTrend('up')">PUSH UP ‚Üë</button>
  <button class="btn-danger" onclick="setTrend('down')">PUSH DOWN ‚Üì</button>
  <button onclick="setTrend('normal')">NORMAL</button>
 </div>
</div>

<!-- REQUESTS -->
<div class="section-title">üì• Wallet Requests</div>
<div id="request-list"><small>Loading...</small></div>

<!-- USERS -->
<div class="section-title">üë• Users & Balances</div>
<div id="user-list"><small>Loading...</small></div>

<script type="module">
/* üîê ADMIN PASSWORD */
const ADMIN_PASS="786786";
const input=prompt("Admin Security Code:");
if(input!==ADMIN_PASS){
 alert("Access Denied");
 location.href="index.html";
}else document.body.style.display="block";

/* üî• FIREBASE */
import{initializeApp}from"https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
import{
 getFirestore,collection,query,where,onSnapshot,
 doc,updateDoc,getDocs,serverTimestamp
}from"https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

const app=initializeApp({
 apiKey:"AIzaSyCuCNl6FOWldVkjGAlqU1eTxPPOWn_pKtY",
 authDomain:"lightspeed-trading-1dec9.firebaseapp.com",
 projectId:"lightspeed-trading-1dec9"
});
const db=getFirestore(app);

/* üìà MARKET TREND CONTROL */
window.setTrend=async(t)=>{
 await updateDoc(doc(db,"market","trend"),{
  mode:t,updated:serverTimestamp()
 });
 alert("Market trend set to "+t.toUpperCase());
};

/* üì• WALLET REQUESTS */
const reqQ=query(collection(db,"requests"),where("status","==","pending"));
onSnapshot(reqQ,snap=>{
 const box=document.getElementById("request-list");
 box.innerHTML="";
 if(snap.empty){box.innerHTML="<small>No pending requests</small>";return;}
 snap.forEach(d=>{
  let r=d.data();
  box.innerHTML+=`
  <div class="card">
   <div class="info">
    <b>${r.type} ‚Çπ${r.amount}</b>
    <span>${r.email}</span>
   </div>
   <div>
    <button class="btn-ok" onclick="approve('${d.id}','${r.uid}',${r.amount},'${r.type}')">Approve</button>
    <button class="btn-danger" onclick="reject('${d.id}')">Reject</button>
   </div>
  </div>`;
 });
});

/* ‚úÖ APPROVE / ‚ùå REJECT */
window.approve=async(id,uid,amt,type)=>{
 const uref=doc(db,"users",uid);
 const users=await getDocs(query(collection(db,"users")));
 let wallet=0;
 users.forEach(u=>{if(u.id===uid)wallet=u.data().wallet});
 let newBal= type==="Deposit"? wallet+amt : wallet-amt;

 await updateDoc(uref,{wallet:newBal});
 await updateDoc(doc(db,"requests",id),{status:"approved"});
 alert("Approved");
};

window.reject=async(id)=>{
 await updateDoc(doc(db,"requests",id),{status:"rejected"});
};

/* üë• USERS LIST */
onSnapshot(collection(db,"users"),snap=>{
 const box=document.getElementById("user-list");
 box.innerHTML="";
 snap.forEach(d=>{
  let u=d.data();
  box.innerHTML+=`
  <div class="card">
   <div class="info">
    <b>‚Çπ${u.wallet.toFixed(2)}</b>
    <span>User: ${d.id}</span>
   </div>
  </div>`;
 });
});
</script>
</body>
</html>
