<!DOCTYPE html>
<html lang="hi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SAHI Admin | Full Control</title>
    <style>
        :root { --bg: #0b0e14; --card: #161b22; --primary: #6366f1; --success: #22c55e; --danger: #ef4444; }
        body { background: var(--bg); color: white; font-family: 'Segoe UI', sans-serif; padding: 20px; display: none; }
        .header { border-bottom: 1px solid #30363d; padding-bottom: 15px; margin-bottom: 30px; }
        .section-title { font-size: 18px; color: var(--primary); margin: 20px 0 10px 0; border-left: 4px solid var(--primary); padding-left: 10px; }
        
        .req-card, .user-card { background: var(--card); padding: 15px; border-radius: 12px; margin-bottom: 10px; border: 1px solid #30363d; display: flex; justify-content: space-between; align-items: center; }
        
        button { padding: 8px 15px; border-radius: 6px; border: none; cursor: pointer; font-weight: bold; font-size: 12px; }
        .btn-approve { background: var(--success); color: #000; }
        .btn-edit { background: var(--primary); color: white; }
        
        .user-info b { font-size: 14px; }
        .user-info span { font-size: 12px; opacity: 0.6; display: block; }
    </style>
</head>
<body>

    <div class="header">
        <h1>üõ†Ô∏è SAHI Pro Admin</h1>
    </div>

    <div class="section-title">üì• Pending Wallet Requests</div>
    <div id="request-list"><small>Loading...</small></div>

    <div class="section-title">üë• User Management (Manual Edit)</div>
    <div id="user-list"><small>Loading users...</small></div>

    <script type="module">
        // --- 1. PASSWORD PROTECTION ---
        const SECRET_PASSWORD = "YOUR_ADMIN_PASSWORD"; // <-- Apna Password Yahan Badlein
        const access = prompt("Admin Secret Password:");
        if (access !== SECRET_PASSWORD) {
            alert("Unauthorized!");
            window.location.href = "index.html";
        } else {
            document.body.style.display = "block";
        }

        // --- 2. FIREBASE CONFIG ---
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getFirestore, collection, query, where, onSnapshot, doc, updateDoc, getDoc, getDocs } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

        const firebaseConfig = {
            apiKey: "AIzaSyCuCNl6FOWldVkjGAlqU1eTxPPOWn_pKtY",
            authDomain: "lightspeed-trading-1dec9.firebaseapp.com",
            projectId: "lightspeed-trading-1dec9",
            storageBucket: "lightspeed-trading-1dec9.firebasestorage.app",
            messagingSenderId: "787355268629",
            appId: "1:787355268629:web:c5c39b7706c6a3548e001c"
        };

        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);

        // --- 3. SYNC REQUESTS ---
        const qReq = query(collection(db, "requests"), where("status", "==", "pending"));
        onSnapshot(qReq, (snap) => {
            const div = document.getElementById('request-list');
            div.innerHTML = snap.empty ? "<small>No pending requests.</small>" : "";
            snap.forEach(d => {
                const r = d.data();
                div.innerHTML += `
                    <div class="req-card">
                        <div class="user-info"><b>${r.email}</b><span>${r.type}: ‚Çπ${r.amount}</span></div>
                        <button class="btn-approve" onclick="approveReq('${d.id}','${r.uid}',${r.amount},'${r.type}')">Approve</button>
                    </div>`;
            });
        });

        // --- 4. SYNC USER LIST ---
        onSnapshot(collection(db, "users"), (snap) => {
            const div = document.getElementById('user-list');
            div.innerHTML = "";
            snap.forEach(d => {
                const u = d.data();
                div.innerHTML += `
                    <div class="user-card">
                        <div class="user-info"><b>${u.name || 'User'}</b><span>Bal: ‚Çπ${u.wallet.toFixed(2)} | Hold: ${u.holdings}</span></div>
                        <button class="btn-edit" onclick="manualEdit('${d.id}', ${u.wallet})">Edit Bal</button>
                    </div>`;
            });
        });

        // --- 5. ACTIONS ---
        window.approveReq = async (id, uid, amt, type) => {
            const uRef = doc(db, "users", uid);
            const snap = await getDoc(uRef);
            let newBal = type === 'Deposit' ? snap.data().wallet + amt : snap.data().wallet - amt;
            await updateDoc(uRef, { wallet: newBal });
            await updateDoc(doc(db, "requests", id), { status: "approved" });
            alert("Approved!");
        };

        window.manualEdit = async (uid, oldBal) => {
            const newBal = prompt("Naya Balance daalein (Current: ‚Çπ"+oldBal+")", oldBal);
            if(newBal !== null) {
                await updateDoc(doc(db, "users", uid), { wallet: parseFloat(newBal) });
                alert("Balance Updated!");
            }
        };
    </script>
</body>
</html>
