<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>SAHI Pro Trading</title>

<!-- Fonts -->
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800&family=Playfair+Display:ital,wght@1,500&display=swap" rel="stylesheet">

<!-- Chart -->
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<style>
:root{
 --bg:#0b0e14;--primary:#38bdf8;--green:#22c55e;--red:#ef4444;
}
body{margin:0;font-family:Inter,sans-serif;background:var(--bg);color:#fff}
.container{max-width:420px;margin:auto;padding:20px}
.hidden{display:none}

/* AUTH */
.auth-hero{min-height:100vh;display:flex;align-items:center;justify-content:center}
.auth-card{
 background:linear-gradient(145deg,#0f172a,#020617);
 padding:40px 24px;border-radius:26px;text-align:center;
 box-shadow:0 30px 70px rgba(0,0,0,.7)
}
.auth-tagline{
 font-family:'Playfair Display',serif;font-style:italic;
 font-size:18px;margin:25px 0 35px;
 background:linear-gradient(90deg,#facc15,#fb923c,#facc15);
 -webkit-background-clip:text;-webkit-text-fill-color:transparent;
}
.google-btn{
 width:100%;height:56px;border:none;border-radius:16px;
 background:#fff;font-weight:700;display:flex;gap:14px;
 align-items:center;justify-content:center;cursor:pointer;
}
.google-btn img{width:26px}

/* APP */
.glass{
 background:linear-gradient(145deg,#1e293b,#0f172a);
 border-radius:22px;padding:20px;margin-bottom:20px
}
.header{display:flex;justify-content:space-between;align-items:center}
.avatar{
 width:36px;height:36px;border-radius:50%;
 background:var(--primary);display:grid;place-items:center;font-weight:800
}
.tabs{display:grid;grid-template-columns:repeat(3,1fr);gap:10px;margin:20px 0}
.tab-btn{padding:10px;border-radius:12px;border:none;background:#1e293b;color:#94a3b8}
.tab-btn.active{background:var(--primary);color:#000}
.chart-box{height:220px}
.btn{padding:16px;border-radius:18px;border:none;font-weight:800;width:100%}
.btn-buy{background:var(--green)}
.btn-sell{background:var(--red);color:#fff}
</style>
</head>

<body>

<!-- AUTH PAGE -->
<div id="auth-page" class="auth-hero">
 <div class="auth-card">
  <h1>SAHI</h1>
  <div class="auth-tagline">Aaj hi apne paiso ko kaam par lagao</div>
  <button class="google-btn" onclick="login()">
   <img src="https://upload.wikimedia.org/wikipedia/commons/4/4a/Logo_2013_Google.png">
   Continue with Google
  </button>
 </div>
</div>

<!-- APP PAGE -->
<div id="app-page" class="container hidden">

<div class="header">
 <div style="display:flex;gap:10px;align-items:center">
  <div class="avatar" id="u-initial">U</div>
  <div>Hi, <b id="u-name">Trader</b></div>
 </div>
 <button onclick="logout()" style="background:none;border:none;color:#888">Logout</button>
</div>

<div class="glass">
 <div style="opacity:.6">Lightspeed / INR</div>
 <div id="price" style="font-size:32px;font-weight:800">₹0.00</div>
 <div class="chart-box"><canvas id="chart"></canvas></div>
</div>

<div class="tabs">
 <button class="tab-btn active" onclick="showTab('market',this)">Market</button>
 <button class="tab-btn" onclick="showTab('history',this)">History</button>
 <button class="tab-btn" onclick="showTab('wallet',this)">Wallet</button>
</div>

<div id="market">
 <div style="display:grid;grid-template-columns:1fr 1fr;gap:15px">
  <button class="btn btn-sell" onclick="trade('sell')">Sell</button>
  <button class="btn btn-buy" onclick="trade('buy')">Buy</button>
 </div>
</div>

<div id="history" class="hidden"></div>

<div id="wallet" class="hidden">
 <div class="glass">Wallet Balance ₹<b id="bal">0.00</b></div>
</div>

</div>

<!-- FIREBASE + LOGIC -->
<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
import { getAuth, GoogleAuthProvider, signInWithPopup, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";
import { getFirestore, collection, addDoc, onSnapshot, query, orderBy, limit, serverTimestamp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";
import { getAnalytics, logEvent, setUserId } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-analytics.js";

const firebaseConfig = {
 apiKey: "AIzaSyCuCNl6FOWldVkjGAlqU1eTxPPOWn_pKtY",
 authDomain: "lightspeed-trading-1dec9.firebaseapp.com",
 projectId: "lightspeed-trading-1dec9",
 storageBucket: "lightspeed-trading-1dec9.firebasestorage.app",
 messagingSenderId: "787355268629",
 appId: "1:787355268629:web:c5c39b7706c6a3548e001c",
 measurementId: "G-BMG3R0GB2T"
};

const app = initializeApp(firebaseConfig);
const analytics = getAnalytics(app);
const auth = getAuth(app);
const db = getFirestore(app);
const provider = new GoogleAuthProvider();

let chart, price = 150;

/* MARKET ENGINE (GLOBAL SYNC) */
setInterval(async()=>{
 price += (Math.random()-0.5)*2;
 await addDoc(collection(db,"market_history"),{
  price, time: serverTimestamp()
 });
},4000);

/* CHART */
function initChart(){
 chart = new Chart(document.getElementById('chart'),{
  type:'line',
  data:{labels:[],datasets:[{data:[],borderColor:'#38bdf8',tension:.4}]},
  options:{plugins:{legend:{display:false}},scales:{x:{display:false}}}
 });

 const q = query(collection(db,"market_history"),orderBy("time"),limit(20));
 onSnapshot(q,s=>{
  const arr = s.docs.map(d=>d.data().price);
  chart.data.datasets[0].data = arr;
  chart.update();
  price = arr[arr.length-1] || price;
  document.getElementById("price").innerText = "₹"+price.toFixed(2);
 });
 logEvent(analytics,'market_view');
}

/* AUTH */
window.login = ()=>signInWithPopup(auth,provider);

window.logout = ()=>{
 logEvent(analytics,'logout');
 signOut(auth).then(()=>location.reload());
};

onAuthStateChanged(auth,u=>{
 if(u){
  setUserId(analytics,u.uid);
  logEvent(analytics,'login_success',{method:'google'});
  authPage.classList.add("hidden");
  appPage.classList.remove("hidden");
  uName.innerText = u.displayName;
  uInitial.innerText = u.displayName[0];
  initChart();
 }
});

/* UI */
window.showTab = (id,btn)=>{
 ['market','history','wallet'].forEach(s=>document.getElementById(s).classList.add("hidden"));
 document.getElementById(id).classList.remove("hidden");
 document.querySelectorAll('.tab-btn').forEach(b=>b.classList.remove("active"));
 btn.classList.add("active");
 logEvent(analytics,'screen_view',{screen:id});
};

/* TRADE */
window.trade = async(type)=>{
 const qty = parseInt(prompt("Qty"));
 if(!qty) return;
 await addDoc(collection(db,"trades"),{
  uid:auth.currentUser.uid,type,qty,price,time:serverTimestamp()
 });
 logEvent(analytics,'trade_execute',{type,qty,price});
 alert(type.toUpperCase()+" @ ₹"+price.toFixed(2));
};
</script>

</body>
</html>
